<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Chat Room: Replicated Chat Server With Multicast - Roy N. Wu</title><meta name="Description" content="Roy Wu"><meta property="og:title" content="Chat Room: Replicated Chat Server With Multicast" />
<meta property="og:description" content="This repository contains implementation of a simple replicated chat server that uses multicast to distribute the chat messages to the different replicas. The servers have the option to deliver clients’ messages following three different types of ordering protocols: Unordered, FIFO, or total. All communications are done via unicast UDP.
Overview The figure below shows a sketch of the system. There are two kinds of processes: servers (represented by orange squares) and clients (represented by yellow circles)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://roynwu.github.io/chat-server/" />
<meta property="og:image" content="https://roynwu.github.io/img/avatar.JPG"/>
<meta property="article:published_time" content="2021-11-11T23:16:22-07:00" />
<meta property="article:modified_time" content="2021-11-11T23:16:22-07:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://roynwu.github.io/img/avatar.JPG"/>

<meta name="twitter:title" content="Chat Room: Replicated Chat Server With Multicast"/>
<meta name="twitter:description" content="This repository contains implementation of a simple replicated chat server that uses multicast to distribute the chat messages to the different replicas. The servers have the option to deliver clients’ messages following three different types of ordering protocols: Unordered, FIFO, or total. All communications are done via unicast UDP.
Overview The figure below shows a sketch of the system. There are two kinds of processes: servers (represented by orange squares) and clients (represented by yellow circles)."/>
<meta name="application-name" content="Roy Wu">
<meta name="apple-mobile-web-app-title" content="Roy Wu"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://roynwu.github.io/chat-server/" /><link rel="prev" href="https://roynwu.github.io/headline-writer/" /><link rel="next" href="https://roynwu.github.io/penn-cloud/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Chat Room: Replicated Chat Server With Multicast",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/roynwu.github.io\/chat-server\/"
        },"image": {
                "@type": "ImageObject",
                "url": "https:\/\/roynwu.github.io\/img\/projects\/headline-writer\/featured-image.JPG",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "Distributed Systems","wordcount":  1386 ,
        "url": "https:\/\/roynwu.github.io\/chat-server\/","datePublished": "2021-11-11T23:16:22-07:00","dateModified": "2021-11-11T23:16:22-07:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
                "@type": "Organization",
                "name": "Roy Wu",
                "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/roynwu.github.io\/img\/avatar.JPG",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "Roy Wu"
            },"description": ""
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Roy N. Wu"> Roy Wu<span class="header-title-post">Software Engineer</span></a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> Home </a><a class="menu-item" href="/projects/"> Projects </a><a class="menu-item" href="/about/"> About </a><a class="menu-item" href="/resume/resume.pdf"> Resume </a><a class="menu-item" href="https://github.com/roynwu" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i>  </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Roy N. Wu"> Roy Wu<span class="header-title-post">Software Engineer</span></a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/" title="">Home</a><a class="menu-item" href="/projects/" title="">Projects</a><a class="menu-item" href="/about/" title="">About</a><a class="menu-item" href="/resume/resume.pdf" title="">Resume</a><a class="menu-item" href="https://github.com/roynwu" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Chat Room: Replicated Chat Server With Multicast</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://roynwu.github.io" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>Roy Wu</a></span>&nbsp;<span class="post-category">included in <a href="/categories/projects/"><i class="far fa-folder fa-fw"></i>Projects</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-11-11">2021-11-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1386 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;7 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading/normal.min.svg"
        data-src="/img/projects/chat-server/featured-image-alt2.JPG"
        data-srcset="/img/projects/chat-server/featured-image-alt2.JPG, /img/projects/chat-server/featured-image-alt2.JPG 1.5x, /img/projects/chat-server/featured-image-alt2.JPG 2x"
        data-sizes="auto"
        alt="/img/projects/chat-server/featured-image-alt2.JPG"
        title="/img/projects/chat-server/featured-image-alt2.JPG" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a></li>
        <li><a href="#specification">Specification</a>
          <ul>
            <li><a href="#the-client">The Client</a></li>
            <li><a href="#commands">Commands</a></li>
            <li><a href="#the-server">The Server</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>This repository contains implementation of a simple replicated chat server that uses multicast to distribute the chat messages to the different replicas. The servers have the option to deliver clients’ messages following three different types of ordering protocols: Unordered, FIFO, or total. All communications are done via unicast UDP.</p>
<!-- [**[paper](report.pdf)**] [**[code](https://github.com/roynwu/Artificial-Anime-Character-Design)**] -->
<h3 id="overview">Overview</h3>
<p>The figure below shows a sketch of the system. There are two kinds of processes: servers (represented by orange squares) and clients (represented by yellow circles). Each client is connected to one of the servers, and each server is connected to all the
other servers. The clients and servers can all run on different machines, or (e.g., for testing) they can all run on the same machine.
<br/>
<figure><a class="lightgallery" href="/img/projects/chat-server/architecture_diagram.png" title="/img/projects/chat-server/architecture_diagram.png" data-thumbnail="/img/projects/chat-server/architecture_diagram.png" data-sub-html="<h2>Sketch of system</h2>">
        <img
            class="lazyload"
            src="/svg/loading/normal.min.svg"
            data-src="/img/projects/chat-server/architecture_diagram.png"
            data-srcset="/img/projects/chat-server/architecture_diagram.png, /img/projects/chat-server/architecture_diagram.png 1.5x, /img/projects/chat-server/architecture_diagram.png 2x"
            data-sizes="auto"
            alt="/img/projects/chat-server/architecture_diagram.png" width="425" />
    </a><figcaption class="image-caption">Sketch of system</figcaption>
    </figure>
The system provides different chat rooms. Clients can join one of the chat rooms and then post messages, which should be delivered to all the other clients that are currently in the same chat room. If there was only a single server, this would be easy: the server would simply send each message it receives to all the clients who are currently in the relevant room. However,
since there can be multiple servers, this simple approach does not work. Instead, the servers will internally use multicast to deliver the messages.</p>
<p>To make this a little more concrete, consider the following example. In the figure, client D is connected to server S3. Suppose D joins chat room #3, which already contains A and B, and posts a message there (say, &ldquo;Hello&rdquo;). S3 then multicasts D&rsquo;s message to multicast group #3, so it will be delivered to the other servers. (All servers are members of all multicast groups.) The servers then forward D&rsquo;s message to all of the clients that are currently in chat room #3. In this case, S3 will echo it back to D, and S1 will send it to A and B. S2 does not currently have any clients that are in chat room #3, so it ignores the message.</p>
<p>The servers should support three different ordering modes:</p>
<ol>
<li>
<p><strong>Unordered multicast:</strong> Each server delivers the messages to its clients in whatever order the server
happens to receive it</p>
</li>
<li>
<p><strong>FIFO multicast:</strong> The messages from a given client C should be delivered to the other clients in the
order they were sent by C</p>
</li>
<li>
<p><strong>Totally ordered multicast</strong> The messages in a given chat room should be delivered to all the clients
in that room in the same order</p>
</li>
</ol>
<p>The system is fully distributed; in other words, there should not be any central ‘sequencing nodes’. All communication, both between clients and servers and among the servers are via unicast UDP (and not using the OS&rsquo;s built-in multicast primitive). There is an assumption that there is no message loss, and that the messages between servers and clients are not reordered.</p>
<h3 id="specification">Specification</h3>
<h4 id="the-client">The Client</h4>
<p>The user can invoke the client from the command line with the IP address and port (i.e., the bind address) of a particular server as a parameter. Note that each client is connected to exactly one server. The user can then be able to type lines of text (commands or chat messages), and, whenever the user has entered a new line, the chat client can send the line to the server in a single UDP packet (without any trailing CR or LF). The client also listens for UDP packets from the server; whenever it
receives such a packet, it prints its contents to the terminal.</p>
<h4 id="commands">Commands</h4>
<p>When the server receives a line of text from the user, it checks whether it begins with a forward slash (/). If not, the server considers the line to be a chat message; otherwise, it treats it as a command. The following commands are supported:</p>
<ol>
<li>
<p>/join &lt;roomID&gt;: Used to join a particular chat room (Example: /join 7). The roomID is an integer in the set {1, 2, …, N}, where N is the total number of chat rooms. It supports at least N = 10 chat rooms (i.e., with room IDs 1,2,3,&hellip;,10). If the command succeeds, the server responds with a line that starts with +OK (Example: +OK You are now in chat room #7). If the user tries to join more than one chat room at a time, or if the specified chat room does not exist (e.g., the specified room is outside your supported range of room IDs), the server responds with a line that starts with -ERR (Example: -ERR You are already in room #9).</p>
</li>
<li>
<p>/part: Used to leave the current chat room. If successful, the server sends a response that starts with +OK (Example: +OK You have left chat room #7). If the user is not currently in a chat room, the server sends a response that starts with -ERR.</p>
</li>
<li>
<p>/nick: Used to set the user&rsquo;s nickname (Example: /nick Linh). The server responds with a line that starts with +OK. If the user does not explicitly set a nickname, the server uses its IP and port (Example: 127.0.0.1:5005). If the /nick command is used more than once, the server uses the latest nickname.</p>
</li>
<li>
<p>/quit: When the user enters this special command, the chat client sends the command to the server and then terminate. The server removes the chat client from its list of active clients.</p>
</li>
</ol>
<p>If the user sends a text message without having joined a chat room, the server responds with a line that starts with -ERR. Each client cannot be in more than one chat room at a time. Each text message sent by the user is at most 1000 bytes. If the user
terminates the client using CTRL+C, the client behaves in the same way as if it has received a /quit command. If the user enters an invalid command, i.e., the text begins with “/” but does not fall into the above commands, the client responds with a line that starts with -ERR.</p>
<p>Below is an example session (the lines in bold are typed by the user):
<br/><br/>
<figure><a class="lightgallery" href="/img/projects/chat-server/example_session.png" title="/img/projects/chat-server/example_session.png" data-thumbnail="/img/projects/chat-server/example_session.png" data-sub-html="<h2>Example session</h2>">
        <img
            class="lazyload"
            src="/svg/loading/normal.min.svg"
            data-src="/img/projects/chat-server/example_session.png"
            data-srcset="/img/projects/chat-server/example_session.png, /img/projects/chat-server/example_session.png 1.5x, /img/projects/chat-server/example_session.png 2x"
            data-sizes="auto"
            alt="/img/projects/chat-server/example_session.png" width="500" />
    </a><figcaption class="image-caption">Example session</figcaption>
    </figure></p>
<h4 id="the-server">The Server</h4>
<p>This implementation assumes static membership: each server will have access to a configuration file that contains the addresses of all the servers in the system.</p>
<p>Each server will have two potentially different addresses. The first is the forwarding address: this is the IP and port number that other servers use as the destination address when they want to send a message to this server. The second is the bind address: this is the IP and port number on which the server listens for UDP messages from clients and from other servers; it is the address that the server binds to, and also the address that its clients connect to.</p>
<p>The server program requires two command-line arguments. The first is the name of a configuration file that contains the forwarding address and the bind address of all the server instances, and the second is the index of the current server instance in this list. The file should contain one line for each server instance. If the line contains only one IP address and port number (Example: 127.0.0.1:5000), this address serves as both the forwarding address and the bind address for that server. If the line contains two IPs and port numbers separated by a comma (Example: 127.0.0.1:8001,127.0.0.1:5001), the first address is the forwarding address and the second is the bind address. The index of the first server is 1.</p>
<p>For instance, suppose the file foo.txt contains the following lines:
<br/><br/>
<figure><a class="lightgallery" href="/img/projects/chat-server/example_file.png" title="/img/projects/chat-server/example_file.png" data-thumbnail="/img/projects/chat-server/example_file.png" data-sub-html="<h2>Example file</h2>">
        <img
            class="lazyload"
            src="/svg/loading/normal.min.svg"
            data-src="/img/projects/chat-server/example_file.png"
            data-srcset="/img/projects/chat-server/example_file.png, /img/projects/chat-server/example_file.png 1.5x, /img/projects/chat-server/example_file.png 2x"
            data-sizes="auto"
            alt="/img/projects/chat-server/example_file.png" width="350" />
    </a><figcaption class="image-caption">Example file</figcaption>
    </figure></p>
<p>and the server is invoked like this: chatserver foo.txt 2, then the server listens for (all) messages on its bind address, i.e., on 127.0.0.1:5001. When it has a message for the third server, it sends the message to (the third server’s forwarding address) 127.0.0.1:8002, and when it has a message for the first server, it sends the message to (the first server’s forwarding address)
127.0.0.1:8000. In addition, the user would invoke a client of the server using the server’s bind address – e.g., a client of the second server can be invoked like this: chatclient 127.0.0.1:5001.</p>
<p>The server also accepts a option -o on the command line. The -o option is used to select an ordering mode: choices are -o unordered (the default), -o fifo, and -o total.</p>
<p>This implementation is able to support at least 10 servers, with up to 250 clients in total.</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-11-11</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/chat-server/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/distributed-systems/">Distributed Systems</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/headline-writer/" class="prev" rel="prev" title="Headline-Writer: Abstractive Text Summarization with Attention and Pointer-Generator Network"><i class="fas fa-angle-left fa-fw"></i>Headline-Writer: Abstractive Text Summarization with Attention and Pointer-Generator Network</a>
            <a href="/penn-cloud/" class="next" rel="next" title="PennCloud: Distributed Cloud Platform">PennCloud: Distributed Cloud Platform<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">&copy; 2022 <a # href="https://roynwu.github.io">Roy Wu</a> | Powered by <a # href="https://gohugo.io" target="_blank">Hugo</a></div><div class="footer-line"></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
